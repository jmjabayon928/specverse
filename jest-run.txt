npx : PASS backend tests/api/sheetRevisions.test.ts
At C:\Users\jmjab\AppData\Local\Temp\ps-script-75283123-1e81-4e9c-80b3-89c9fd8369f2.ps1:117 char:27
+ ... \specverse; npx jest --runInBand --verbose --testLocationInResults 2> ...
+                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (PASS backend te...visions.test.ts:String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 
  Sheet Revisions API
    Revision Creation
      ΓêÜ should create a revision when updating a filled sheet (1344 ms)
    List Revisions
      ΓêÜ should return paginated revisions (10 ms)
    Get Revision Details
      ΓêÜ should return revision details with snapshot (5 ms)
    Restore Revision
      ΓêÜ should restore a revision and create a new revision (14 ms)

[0mGET /api/backend/templates [32m200[0m 92.371 ms - 2[0m
[0mGET /api/backend/templates [32m200[0m 3.984 ms - 255[0m
[0mGET /api/backend/templates [32m200[0m 3.725 ms - 239[0m
[0mGET /api/backend/templates/reference-options [32m200[0m 3.765 ms - 330[0m
[0mGET /api/backend/templates/note-types [32m200[0m 6.199 ms - -[0m
[0mGET /api/backend/templates/check-tag?tag=%40%40%40_nonexistent_template_tag_%40%40%40&projectId=999999 [32m200[0m 7.385 ms - 16[0m
[0mGET /api/backend/templates/reference-options [32m200[0m 3.307 ms - 330[0m
[0mPOST /api/backend/templates [32m201[0m 3.967 ms - 13[0m
[0mGET /api/backend/templates/1 [32m200[0m 3.767 ms - 126[0m
[0mPUT /api/backend/templates/1 [32m200[0m 3.856 ms - 13[0m
[0mPOST /api/backend/templates/1/verify [32m200[0m 5.247 ms - 53[0m
  console.error
    AppError: Invalid request payload
        at handleError (C:\projects\specverse\src\backend\controllers\templateController.ts:144:10)
        at createTemplateHandler (C:\projects\specverse\src\backend\controllers\templateController.ts:314:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at C:\projects\specverse\src\backend\middleware\authMiddleware.ts:96:7
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 400,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at handleError (src/backend/controllers/templateController.ts:144:5)
      at createTemplateHandler (src/backend/controllers/templateController.ts:314:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at src/backend/middleware/authMiddleware.ts:96:7

[0mPOST /api/backend/templates [33m400[0m 52.367 ms - 92[0m
[0mGET /api/backend/templates/reference-options [32m200[0m 3.137 ms - 330[0m
  console.error
    AppError: Invalid request payload
        at handleError (C:\projects\specverse\src\backend\controllers\templateController.ts:144:10)
        at createTemplateHandler (C:\projects\specverse\src\backend\controllers\templateController.ts:314:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at C:\projects\specverse\src\backend\middleware\authMiddleware.ts:96:7
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 400,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at handleError (src/backend/controllers/templateController.ts:144:5)
      at createTemplateHandler (src/backend/controllers/templateController.ts:314:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at src/backend/middleware/authMiddleware.ts:96:7

[0mPOST /api/backend/templates [33m400[0m 8.689 ms - 92[0m
  console.error
    AppError: Invalid template ID
        at updateTemplateHandler (C:\projects\specverse\src\backend\controllers\templateController.ts:334:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at C:\projects\specverse\src\backend\middleware\auditMiddleware.ts:43:5
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at C:\projects\specverse\src\backend\middleware\authMiddleware.ts:96:7
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 400,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at updateTemplateHandler (src/backend/controllers/templateController.ts:334:7)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at src/backend/middleware/auditMiddleware.ts:43:5
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at src/backend/middleware/authMiddleware.ts:96:7

[0mPUT /api/backend/templates/0 [33m400[0m 11.698 ms - 84[0m
  console.error
    AppError: Invalid template ID
        at verifyTemplateHandler (C:\projects\specverse\src\backend\controllers\templateController.ts:363:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at C:\projects\specverse\src\backend\middleware\auditMiddleware.ts:43:5
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at C:\projects\specverse\src\backend\middleware\authMiddleware.ts:96:7
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 400,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at verifyTemplateHandler (src/backend/controllers/templateController.ts:363:7)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at src/backend/middleware/auditMiddleware.ts:43:5
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at src/backend/middleware/authMiddleware.ts:96:7

[0mPOST /api/backend/templates/0/verify [33m400[0m 8.174 ms - 84[0m
PASS backend tests/api/datasheets.templates.test.ts
  Templates API
    ΓêÜ GET /api/backend/templates should return 200 and array with optional discipline fields (99 ms)
    ΓêÜ GET /api/backend/templates returns disciplineName/subtypeName when DB returns rows with IDs (8 ms)
    ΓêÜ GET /api/backend/templates returns null disciplineName/subtypeName when DisciplineID/SubtypeID are null (7 ms)
    ΓêÜ GET /api/backend/templates/reference-options should return 200 with disciplines/subtypes shaped by id, code 
(Code column), name (Name column) (8 ms)
    ΓêÜ GET /api/backend/templates/note-types should return 200 and an array (12 ms)
    ΓêÜ GET /api/backend/templates/check-tag should return exists=false for fake tag (11 ms)
    ΓêÜ POST ΓåÆ GET ΓåÆ PUT ΓåÆ VERIFY template (happy path) (47 ms)
    ΓêÜ POST /api/backend/templates should reject invalid body (61 ms)
    ΓêÜ POST /api/backend/templates should return 400 when disciplineId is missing (19 ms)
    ΓêÜ PUT /api/backend/templates/:id should reject invalid id or body (16 ms)
    ΓêÜ POST /api/backend/templates/:id/verify should reject invalid payload (14 ms)

PASS frontend tests/ui/datasheets/TemplateEditorForm.test.tsx
  TemplateEditorForm
    ΓêÜ renders without throwing when session is null (174 ms)
    ΓêÜ renders core fields and subsheets (106 ms)
    ΓêÜ submits a PUT request with fieldValues and updated sheetName on success (626 ms)

[0mGET /api/backend/filledsheets [32m200[0m 33.786 ms - 2[0m
[0mGET /api/backend/filledsheets/reference-options [32m200[0m 9.361 ms - 868[0m
[0mGET /api/backend/filledsheets/check-equipment-tag?tag=%40%40%40_nonexistent_filled_tag_%40%40%40&projectId=999999 [32m200[0m 6.925 ms - 16[0m
  console.error
    Failed to create filled sheet Error: VALIDATION: Missing required field: Sheet Name; Missing required field: Equipment Name; Missing required field: Equipment Tag Number; Missing required field: Category; Missing required field: Client; Missing required field: Project; Invalid templateId.
        at validateTopLevel (C:\projects\specverse\src\backend\services\filledSheetService.ts:264:11)
        at C:\projects\specverse\src\backend\services\filledSheetService.ts:165:27
        at runInTransaction (C:\projects\specverse\src\backend\services\filledSheetService.ts:206:23)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at async createFilledSheetHandler (C:\projects\specverse\src\backend\controllers\filledSheetController.ts:282:21)

      142 |   }
      143 |
    > 144 |   console.error(fallbackMessage, err)
          |           ^
      145 |   next(new AppError(fallbackMessage, 500))
      146 | }
      147 |

      at handleError (src/backend/controllers/filledSheetController.ts:144:11)
      at createFilledSheetHandler (src/backend/controllers/filledSheetController.ts:286:5)

  console.error
    AppError: Failed to create filled sheet
        at handleError (C:\projects\specverse\src\backend\controllers\filledSheetController.ts:145:8)
        at createFilledSheetHandler (C:\projects\specverse\src\backend\controllers\filledSheetController.ts:286:5)
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 500,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at handleError (src/backend/controllers/filledSheetController.ts:145:3)
      at createFilledSheetHandler (src/backend/controllers/filledSheetController.ts:286:5)

[0mPOST /api/backend/filledsheets [31m500[0m 32.174 ms - 114[0m
  console.error
    AppError: Invalid sheet ID
        at updateFilledSheetHandler (C:\projects\specverse\src\backend\controllers\filledSheetController.ts:296:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at C:\projects\specverse\src\backend\middleware\auditMiddleware.ts:43:5
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at C:\projects\specverse\src\backend\middleware\authMiddleware.ts:96:7
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 400,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at updateFilledSheetHandler (src/backend/controllers/filledSheetController.ts:296:7)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at src/backend/middleware/auditMiddleware.ts:43:5
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at src/backend/middleware/authMiddleware.ts:96:7

[0mPUT /api/backend/filledsheets/0 [33m400[0m 13.329 ms - 78[0m
  console.error
    AppError: Invalid sheet ID
        at verifyFilledSheetHandler (C:\projects\specverse\src\backend\controllers\filledSheetController.ts:331:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at C:\projects\specverse\src\backend\middleware\auditMiddleware.ts:43:5
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at C:\projects\specverse\src\backend\middleware\authMiddleware.ts:96:7
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 400,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at verifyFilledSheetHandler (src/backend/controllers/filledSheetController.ts:331:7)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at src/backend/middleware/auditMiddleware.ts:43:5
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at src/backend/middleware/authMiddleware.ts:96:7

[0mPOST /api/backend/filledsheets/0/verify [33m400[0m 9.033 ms - 78[0m
[0mGET /api/backend/filledsheets/reference-options [32m200[0m 7.071 ms - 868[0m
  console.error
    Failed to verify or reject filled sheet RequestError: Cannot insert the value NULL into column 'NotificationID', table 'DataSheets.dbo.Notifications'; column does not allow nulls. INSERT fails.
        at handleError (C:\projects\specverse\node_modules\mssql\lib\tedious\request.js:384:15)
        at Connection.emit (node:events:524:28)
        at Connection.emit (node:domain:489:12)
        at Connection.emit (C:\projects\specverse\node_modules\mssql\node_modules\tedious\src\connection.ts:1927:18)
        at RequestTokenHandler.onErrorMessage (C:\projects\specverse\node_modules\mssql\node_modules\tedious\src\token\handler.ts:386:21)
        at Readable.<anonymous> (C:\projects\specverse\node_modules\mssql\node_modules\tedious\src\token\token-stream-parser.ts:23:55)
        at Readable.emit (node:events:524:28)
        at Readable.emit (node:domain:489:12)
        at addChunk (node:internal/streams/readable:561:12)
        at readableAddChunkPushObjectMode (node:internal/streams/readable:538:3)
        at Readable.push (node:internal/streams/readable:393:5)
        at nextAsync (node:internal/streams/from:194:22)
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      code: 'EREQUEST',
      originalError: Error: Cannot insert the value NULL into column 'NotificationID', table 'DataSheets.dbo.Notifications'; column does not allow nulls. INSERT fails.
          at handleError (C:\projects\specverse\node_modules\mssql\lib\tedious\request.js:382:19)
          at Connection.emit (node:events:524:28)
          at Connection.emit (node:domain:489:12)
          at Connection.emit (C:\projects\specverse\node_modules\mssql\node_modules\tedious\src\connection.ts:1927:18)
          at RequestTokenHandler.onErrorMessage (C:\projects\specverse\node_modules\mssql\node_modules\tedious\src\token\handler.ts:386:21)
          at Readable.<anonymous> (C:\projects\specverse\node_modules\mssql\node_modules\tedious\src\token\token-stream-parser.ts:23:55)
          at Readable.emit (node:events:524:28)
          at Readable.emit (node:domain:489:12)
          at addChunk (node:internal/streams/readable:561:12)
          at readableAddChunkPushObjectMode (node:internal/streams/readable:538:3)
          at Readable.push (node:internal/streams/readable:393:5)
          at nextAsync (node:internal/streams/from:194:22)
          at processTicksAndRejections (node:internal/process/task_queues:95:5) {
        info: ErrorMessageToken {
          name: 'ERROR',
          handlerName: 'onErrorMessage',
          number: 515,
          state: 2,
          class: 16,
          message: "Cannot insert the value NULL into column 'NotificationID', table 'DataSheets.dbo.Notifications'; column does not allow nulls. INSERT fails.",
          serverName: 'Jeff-Desktop',
          procName: '',
          lineNumber: 2
        }
      },
      number: 515,
      lineNumber: 2,
      state: 2,
      class: 16,
      serverName: 'Jeff-Desktop',
      procName: '',
      precedingErrors: []
    }

      142 |   }
      143 |
    > 144 |   console.error(fallbackMessage, err)
          |           ^
      145 |   next(new AppError(fallbackMessage, 500))
      146 | }
      147 |

      at handleError (src/backend/controllers/filledSheetController.ts:144:11)
      at verifyFilledSheetHandler (src/backend/controllers/filledSheetController.ts:347:5)

  console.error
    AppError: Failed to verify or reject filled sheet
        at handleError (C:\projects\specverse\src\backend\controllers\filledSheetController.ts:145:8)
        at verifyFilledSheetHandler (C:\projects\specverse\src\backend\controllers\filledSheetController.ts:347:5)
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 500,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at handleError (src/backend/controllers/filledSheetController.ts:145:3)
      at verifyFilledSheetHandler (src/backend/controllers/filledSheetController.ts:347:5)

[0mPOST /api/backend/filledsheets/1214/verify [31m500[0m 30.842 ms - 134[0m
PASS backend tests/services/filledSheetService.test.ts
  Filled Sheets API
    ΓêÜ GET /api/backend/filledsheets should return 200 and an array (41 ms)
    ΓêÜ GET /api/backend/filledsheets/reference-options should return 200 and an object (13 ms)
    ΓêÜ GET /api/backend/filledsheets/check-equipment-tag should show exists=false for fake tag (14 ms)
    ΓêÜ POST /api/backend/filledsheets should reject invalid body (42 ms)
    ΓêÜ PUT /api/backend/filledsheets/:id should reject invalid id or body (18 ms)
    ΓêÜ POST /api/backend/filledsheets/:id/verify should reject invalid payload (14 ms)
    ΓêÜ POST /api/backend/filledsheets/:id/verify should succeed for a seeded filled sheet (happy path) (64 ms)

[0mGET /api/backend/filledsheets [32m200[0m 32.202 ms - 2[0m
[0mGET /api/backend/filledsheets [32m200[0m 3.153 ms - 255[0m
[0mGET /api/backend/filledsheets [32m200[0m 3.252 ms - 239[0m
[0mGET /api/backend/filledsheets/reference-options [32m200[0m 8.232 ms - 868[0m
[0mGET /api/backend/filledsheets/check-equipment-tag?tag=%40%40%40_nonexistent_filled_tag_%40%40%40&projectId=999999 [32m200[0m 6.957 ms - 16[0m
  console.error
    Failed to create filled sheet Error: VALIDATION: Missing required field: Sheet Name; Missing required field: Equipment Name; Missing required field: Equipment Tag Number; Missing required field: Category; Missing required field: Client; Missing required field: Project; Invalid templateId.
        at validateTopLevel (C:\projects\specverse\src\backend\services\filledSheetService.ts:264:11)
        at C:\projects\specverse\src\backend\services\filledSheetService.ts:165:27
        at runInTransaction (C:\projects\specverse\src\backend\services\filledSheetService.ts:206:23)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at async createFilledSheetHandler (C:\projects\specverse\src\backend\controllers\filledSheetController.ts:282:21)

      142 |   }
      143 |
    > 144 |   console.error(fallbackMessage, err)
          |           ^
      145 |   next(new AppError(fallbackMessage, 500))
      146 | }
      147 |

      at handleError (src/backend/controllers/filledSheetController.ts:144:11)
      at createFilledSheetHandler (src/backend/controllers/filledSheetController.ts:286:5)

  console.error
    AppError: Failed to create filled sheet
        at handleError (C:\projects\specverse\src\backend\controllers\filledSheetController.ts:145:8)
        at createFilledSheetHandler (C:\projects\specverse\src\backend\controllers\filledSheetController.ts:286:5)
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 500,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at handleError (src/backend/controllers/filledSheetController.ts:145:3)
      at createFilledSheetHandler (src/backend/controllers/filledSheetController.ts:286:5)

[0mPOST /api/backend/filledsheets [31m500[0m 14.582 ms - 114[0m
  console.error
    AppError: Invalid sheet ID
        at updateFilledSheetHandler (C:\projects\specverse\src\backend\controllers\filledSheetController.ts:296:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at C:\projects\specverse\src\backend\middleware\auditMiddleware.ts:43:5
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at C:\projects\specverse\src\backend\middleware\authMiddleware.ts:96:7
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 400,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at updateFilledSheetHandler (src/backend/controllers/filledSheetController.ts:296:7)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at src/backend/middleware/auditMiddleware.ts:43:5
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at src/backend/middleware/authMiddleware.ts:96:7

[0mPUT /api/backend/filledsheets/0 [33m400[0m 7.712 ms - 78[0m
  console.error
    AppError: Invalid sheet ID
        at verifyFilledSheetHandler (C:\projects\specverse\src\backend\controllers\filledSheetController.ts:331:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at C:\projects\specverse\src\backend\middleware\auditMiddleware.ts:43:5
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at C:\projects\specverse\src\backend\middleware\authMiddleware.ts:96:7
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 400,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at verifyFilledSheetHandler (src/backend/controllers/filledSheetController.ts:331:7)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at src/backend/middleware/auditMiddleware.ts:43:5
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at src/backend/middleware/authMiddleware.ts:96:7

[0mPOST /api/backend/filledsheets/0/verify [33m400[0m 6.826 ms - 78[0m
PASS backend tests/api/datasheets.filled.test.ts
  Filled Sheets API
    ΓêÜ GET /api/backend/filledsheets should return 200 and array with optional discipline fields (37 ms)
    ΓêÜ GET /api/backend/filledsheets returns disciplineName/subtypeName when DB returns rows with IDs (8 ms)
    ΓêÜ GET /api/backend/filledsheets returns null disciplineName/subtypeName when DisciplineID/SubtypeID are null (8 
ms)
    ΓêÜ GET /api/backend/filledsheets/reference-options should return 200 and an object (14 ms)
    ΓêÜ GET /api/backend/filledsheets/check-equipment-tag should show exists=false for fake tag (14 ms)
    ΓêÜ POST /api/backend/filledsheets should reject invalid body (22 ms)
    ΓêÜ PUT /api/backend/filledsheets/:id should reject invalid id or body (12 ms)
    ΓêÜ POST /api/backend/filledsheets/:id/verify should reject invalid payload (16 ms)

[0mGET /api/backend/estimation [32m200[0m 38.015 ms - -[0m
[0mGET /api/backend/estimation/history [32m200[0m 8.566 ms - -[0m
  console.error
    AppError: Invalid EstimationID
        at parseRouteId (C:\projects\specverse\src\backend\controllers\estimationController.ts:50:11)
        at getEstimationByIdHandler (C:\projects\specverse\src\backend\controllers\estimationController.ts:175:16)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at verifyToken (C:\projects\specverse\src\backend\middleware\authMiddleware.ts:74:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at param (C:\projects\specverse\node_modules\router\index.js:600:14)
        at param (C:\projects\specverse\node_modules\router\index.js:610:14)
        at processParams (C:\projects\specverse\node_modules\router\index.js:664:3)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at logger (C:\projects\specverse\node_modules\morgan\index.js:144:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at compression (C:\projects\specverse\node_modules\compression\index.js:243:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:531:6)
        at xXssProtectionMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:311:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at xPoweredByMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:304:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at xPermittedCrossDomainPoliciesMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:297:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at xFrameOptionsMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:281:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at xDownloadOptionsMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:261:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at xDnsPrefetchControlMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:254:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at xContentTypeOptionsMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:246:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at strictTransportSecurityMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:239:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at referrerPolicyMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:207:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at originAgentClusterMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:182:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at crossOriginResourcePolicyMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:175:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at crossOriginOpenerPolicyMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:159:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at contentSecurityPolicyMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:124:4)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at helmetMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:533:6)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:71:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cors (C:\projects\specverse\node_modules\cors\lib\index.js:188:7)
        at C:\projects\specverse\node_modules\cors\lib\index.js:224:17
        at originCallback (C:\projects\specverse\node_modules\cors\lib\index.js:214:15)
        at C:\projects\specverse\node_modules\cors\lib\index.js:219:13
        at optionsCallback (C:\projects\specverse\node_modules\cors\lib\index.js:199:9)
        at corsMiddleware (C:\projects\specverse\node_modules\cors\lib\index.js:204:7)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at read (C:\projects\specverse\node_modules\body-parser\lib\read.js:53:5)
        at urlencodedParser (C:\projects\specverse\node_modules\body-parser\lib\types\urlencoded.js:57:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at read (C:\projects\specverse\node_modules\body-parser\lib\read.js:53:5)
        at jsonParser (C:\projects\specverse\node_modules\body-parser\lib\types\json.js:88:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at Function.handle (C:\projects\specverse\node_modules\express\lib\application.js:177:15)
        at Server.app (C:\projects\specverse\node_modules\express\lib\express.js:38:9)
        at Server.emit (node:events:524:28)
        at Server.emit (node:domain:489:12)
        at parserOnIncoming (node:_http_server:1141:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:118:17) {
      statusCode: 400,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at getEstimationByIdHandler (src/backend/controllers/estimationController.ts:184:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at verifyToken (src/backend/middleware/authMiddleware.ts:74:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at param (node_modules/router/index.js:600:14)
      at param (node_modules/router/index.js:610:14)
      at processParams (node_modules/router/index.js:664:3)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at logger (node_modules/morgan/index.js:144:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at compression (node_modules/compression/index.js:243:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at internalNext (node_modules/helmet/index.cjs:531:6)
      at xXssProtectionMiddleware (node_modules/helmet/index.cjs:311:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xPoweredByMiddleware (node_modules/helmet/index.cjs:304:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xPermittedCrossDomainPoliciesMiddleware (node_modules/helmet/index.cjs:297:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xFrameOptionsMiddleware (node_modules/helmet/index.cjs:281:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xDownloadOptionsMiddleware (node_modules/helmet/index.cjs:261:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xDnsPrefetchControlMiddleware (node_modules/helmet/index.cjs:254:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xContentTypeOptionsMiddleware (node_modules/helmet/index.cjs:246:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at strictTransportSecurityMiddleware (node_modules/helmet/index.cjs:239:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at referrerPolicyMiddleware (node_modules/helmet/index.cjs:207:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at originAgentClusterMiddleware (node_modules/helmet/index.cjs:182:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at crossOriginResourcePolicyMiddleware (node_modules/helmet/index.cjs:175:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at crossOriginOpenerPolicyMiddleware (node_modules/helmet/index.cjs:159:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at contentSecurityPolicyMiddleware (node_modules/helmet/index.cjs:124:4)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at helmetMiddleware (node_modules/helmet/index.cjs:533:6)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:71:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cors (node_modules/cors/lib/index.js:188:7)

[0mGET /api/backend/estimation/0 [33m400[0m 22.223 ms - 86[0m
[0mGET /api/backend/estimation/history [32m200[0m 10.498 ms - -[0m
[0mPOST /api/backend/estimation [32m201[0m 4.225 ms - 338[0m
  console.error
    ZodError: [
      {
        "code": "invalid_type",
        "expected": "number",
        "received": "nan",
        "path": [
          "ProjectID"
        ],
        "message": "Expected number, received nan"
      },
      {
        "code": "invalid_type",
        "expected": "number",
        "received": "nan",
        "path": [
          "ClientID"
        ],
        "message": "Expected number, received nan"
      }
    ]
        at Object.get error [as error] (C:\projects\specverse\node_modules\zod\v3\types.cjs:45:31)
        at ZodObject.parse (C:\projects\specverse\node_modules\zod\v3\types.cjs:120:22)
        at createEstimationHandler (C:\projects\specverse\src\backend\controllers\estimationController.ts:165:45)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at verifyToken (C:\projects\specverse\src\backend\middleware\authMiddleware.ts:74:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at logger (C:\projects\specverse\node_modules\morgan\index.js:144:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at compression (C:\projects\specverse\node_modules\compression\index.js:243:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:531:6)
        at xXssProtectionMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:311:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at xPoweredByMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:304:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at xPermittedCrossDomainPoliciesMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:297:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at xFrameOptionsMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:281:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at xDownloadOptionsMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:261:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at xDnsPrefetchControlMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:254:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at xContentTypeOptionsMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:246:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at strictTransportSecurityMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:239:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at referrerPolicyMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:207:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at originAgentClusterMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:182:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at crossOriginResourcePolicyMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:175:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at crossOriginOpenerPolicyMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:159:3)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at contentSecurityPolicyMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:124:4)
        at internalNext (C:\projects\specverse\node_modules\helmet\index.cjs:529:6)
        at helmetMiddleware (C:\projects\specverse\node_modules\helmet\index.cjs:533:6)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:71:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cors (C:\projects\specverse\node_modules\cors\lib\index.js:188:7)
        at C:\projects\specverse\node_modules\cors\lib\index.js:224:17
        at originCallback (C:\projects\specverse\node_modules\cors\lib\index.js:214:15)
        at C:\projects\specverse\node_modules\cors\lib\index.js:219:13
        at optionsCallback (C:\projects\specverse\node_modules\cors\lib\index.js:199:9)
        at corsMiddleware (C:\projects\specverse\node_modules\cors\lib\index.js:204:7)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at read (C:\projects\specverse\node_modules\body-parser\lib\read.js:42:5)
        at urlencodedParser (C:\projects\specverse\node_modules\body-parser\lib\types\urlencoded.js:57:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at C:\projects\specverse\node_modules\body-parser\lib\read.js:171:5
        at AsyncResource.runInAsyncScope (node:async_hooks:206:9)
        at invokeCallback (C:\projects\specverse\node_modules\raw-body\index.js:238:16)
        at done (C:\projects\specverse\node_modules\raw-body\index.js:227:7)
        at IncomingMessage.onEnd (C:\projects\specverse\node_modules\raw-body\index.js:287:7)
        at IncomingMessage.emit (node:events:524:28)
        at IncomingMessage.emit (node:domain:489:12)
        at endReadableNT (node:internal/streams/readable:1698:12)
        at processTicksAndRejections (node:internal/process/task_queues:82:21) {
      issues: [
        {
          code: 'invalid_type',
          expected: 'number',
          received: 'nan',
          path: [Array],
          message: 'Expected number, received nan'
        },
        {
          code: 'invalid_type',
          expected: 'number',
          received: 'nan',
          path: [Array],
          message: 'Expected number, received nan'
        }
      ],
      addIssue: [Function (anonymous)],
      addIssues: [Function (anonymous)],
      errors: [
        {
          code: 'invalid_type',
          expected: 'number',
          received: 'nan',
          path: [Array],
          message: 'Expected number, received nan'
        },
        {
          code: 'invalid_type',
          expected: 'number',
          received: 'nan',
          path: [Array],
          message: 'Expected number, received nan'
        }
      ]
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at createEstimationHandler (src/backend/controllers/estimationController.ts:169:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at verifyToken (src/backend/middleware/authMiddleware.ts:74:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at logger (node_modules/morgan/index.js:144:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at compression (node_modules/compression/index.js:243:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at internalNext (node_modules/helmet/index.cjs:531:6)
      at xXssProtectionMiddleware (node_modules/helmet/index.cjs:311:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xPoweredByMiddleware (node_modules/helmet/index.cjs:304:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xPermittedCrossDomainPoliciesMiddleware (node_modules/helmet/index.cjs:297:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xFrameOptionsMiddleware (node_modules/helmet/index.cjs:281:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xDownloadOptionsMiddleware (node_modules/helmet/index.cjs:261:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xDnsPrefetchControlMiddleware (node_modules/helmet/index.cjs:254:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at xContentTypeOptionsMiddleware (node_modules/helmet/index.cjs:246:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at strictTransportSecurityMiddleware (node_modules/helmet/index.cjs:239:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at referrerPolicyMiddleware (node_modules/helmet/index.cjs:207:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at originAgentClusterMiddleware (node_modules/helmet/index.cjs:182:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at crossOriginResourcePolicyMiddleware (node_modules/helmet/index.cjs:175:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at crossOriginOpenerPolicyMiddleware (node_modules/helmet/index.cjs:159:3)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at contentSecurityPolicyMiddleware (node_modules/helmet/index.cjs:124:4)
      at internalNext (node_modules/helmet/index.cjs:529:6)
      at helmetMiddleware (node_modules/helmet/index.cjs:533:6)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:71:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cors (node_modules/cors/lib/index.js:188:7)
      at node_modules/cors/lib/index.js:224:17
      at originCallback (node_modules/cors/lib/index.js:214:15)

[0mPOST /api/backend/estimation [31m500[0m 14.482 ms - 98[0m
[0mGET /api/backend/estimation/quotes/all [32m200[0m 9.207 ms - -[0m
[0mGET /api/backend/estimation/quotes/all [32m200[0m 8.405 ms - -[0m
[0mPUT /api/backend/estimation/quotes/1 [32m200[0m 3.872 ms - 150[0m
PASS backend tests/api/estimation.test.ts
  Estimation API
    ΓêÜ should GET all estimations (50 ms)
    ΓêÜ GET /api/backend/estimation/history never routes to :id handler (regression) (13 ms)
    ΓêÜ GET /api/backend/estimation/0 hits :id handler and returns 400 or 404 (30 ms)
    ΓêÜ GET /api/backend/estimation/history returns 200 and an array with correct shape (16 ms)
    ΓêÜ should POST a new estimation (12 ms)
    ΓêÜ should return 400 or 500 if required fields are missing (24 ms)
    ΓêÜ GET /api/backend/estimation/quotes/all returns 200 and every quote row has unique QuoteRowID (39 ms)
    ΓêÜ PUT /api/backend/estimation/quotes/:id returns minimal SupplierQuoteUpdateResponse shape (22 ms)

  console.warn
    Γ¢ö No token received

      48 |
      49 |   if (!token) {
    > 50 |     console.warn('Γ¢ö No token received')
         |             ^
      51 |     next(new AppError('Unauthorized - No token', 401))
      52 |     return
      53 |   }

      at verifyToken (src/backend/middleware/authMiddleware.ts:50:13)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:53:5)
      at jsonParser (node_modules/body-parser/lib/types/json.js:88:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

  console.error
    AppError: Unauthorized - No token
        at verifyToken (C:\projects\specverse\src\backend\middleware\authMiddleware.ts:51:10)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:57:14)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at read (C:\projects\specverse\node_modules\body-parser\lib\read.js:53:5)
        at jsonParser (C:\projects\specverse\node_modules\body-parser\lib\types\json.js:88:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at Function.handle (C:\projects\specverse\node_modules\express\lib\application.js:177:15)
        at Server.app (C:\projects\specverse\node_modules\express\lib\express.js:38:9)
        at Server.emit (node:events:524:28)
        at Server.emit (node:domain:489:12)
        at parserOnIncoming (node:_http_server:1141:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:118:17) {
      statusCode: 401,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at next (node_modules/router/lib/route.js:155:13)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at next (node_modules/router/lib/route.js:155:13)
      at verifyToken (src/backend/middleware/authMiddleware.ts:51:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:53:5)
      at jsonParser (node_modules/body-parser/lib/types/json.js:88:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

PASS backend tests/api/inventory.transactions.test.ts
  Inventory Transactions API
    Authentication
      ΓêÜ returns 401 when unauthenticated (129 ms)
      ΓêÜ returns 200 when authenticated with INVENTORY_VIEW permission (41 ms)
    List Endpoint Response Shape
      ΓêÜ returns { page, pageSize, total, rows } with defaults (9 ms)
    Filtering
      ΓêÜ filter by warehouseId reduces results (13 ms)
      ΓêÜ filter by transactionType reduces results (7 ms)
      ΓêÜ filter by dateFrom and dateTo reduces results (9 ms)
      ΓêÜ filter by itemId reduces results (7 ms)
    CSV Export
      ΓêÜ returns text/csv content type (7 ms)
      ΓêÜ includes header row in CSV (7 ms)
      ΓêÜ includes data rows in CSV (8 ms)
      ΓêÜ applies filters to CSV export (7 ms)
      ΓêÜ returns 413 when CSV limit exceeded (9 ms)
    Pagination
      ΓêÜ pageSize=1 returns 1 row (7 ms)

PASS frontend tests/ui/datasheets/ComparePageClient.test.tsx
  ComparePageClient
    ΓêÜ renders compare table with headers and mock data (91 ms)
    ΓêÜ shows Accepted badge when varianceStatus is DeviatesAccepted (6 ms)
    ΓêÜ shows Rejected badge when varianceStatus is DeviatesRejected (7 ms)
    ΓêÜ calls PATCH variances with status DeviatesAccepted when clicking Accept (44 ms)
    ΓêÜ calls PATCH variances with status DeviatesRejected when clicking Reject (46 ms)
    ΓêÜ calls PATCH variances with status null when clicking Clear (59 ms)
    ΓêÜ does not show Accept/Reject/Clear when ValueSet status is Locked or Verified (12 ms)

PASS frontend tests/ui/datasheets/FilledSheetEditorForm.test.tsx
  FilledSheetEditorForm
    ΓêÜ renders and shows subsheet form (50 ms)
    ΓêÜ PUTs to /api/backend/filledsheets/:id with fieldValues (60 ms)
    ΓêÜ shows completeness hint when a required subsheet field is empty (25 ms)
    ΓêÜ shows all complete when all required subsheet fields are filled (19 ms)
    ΓêÜ submit button is enabled when required field is empty (hints do not block) (34 ms)

PASS frontend tests/ui/datasheets/TemplateClonerForm.test.tsx
  TemplateClonerForm
    ΓêÜ requires at least one subsheet and shows error if none (156 ms)
    ΓêÜ POSTs to /api/backend/templates on success (272 ms)

PASS backend tests/api/valuesets.filled.test.ts
  Phase 2 value-set plumbing
    GET filled sheet (same payload shape)
      ΓêÜ returns same payload shape with datasheet.subsheets and fields (440 ms)
    PUT filled sheet (rejected when status Locked)
      ΓêÜ returns 409 when ValueSet status is Locked (9 ms)
    ensureRequirementValueSet (creates one, reuses)
      ΓêÜ createValueSet is called once for Requirement; getValueSetId returns same id on list (7 ms)
      ΓêÜ GET /sheets/:sheetId/valuesets?context=Requirement returns valueSetId when set exists (8 ms)
      ΓêÜ GET /sheets/:sheetId/valuesets returns items array when no context filter (7 ms)
    PUT writes rows with ValueSetID and UOM (service contract)
      ΓêÜ updateFilledSheet is called with sheetId and merged body including subsheets (6 ms)

  console.error
    Error inserting logo: Error: EISDIR: illegal operation on a directory, read
        at Object.readSync (node:fs:750:18)
        at tryReadSync (node:fs:424:20)
        at Object.readFileSync (node:fs:478:19)
        at generateDatasheetExcel (C:\projects\specverse\src\utils\generateDatasheetExcel.ts:246:20)
        at Object.<anonymous> (C:\projects\specverse\tests\utils\generateDatasheetExcel.test.ts:80:52)
        at Promise.then.completed (C:\projects\specverse\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\projects\specverse\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\projects\specverse\node_modules\jest-circus\build\run.js:316:40)
        at async _runTest (C:\projects\specverse\node_modules\jest-circus\build\run.js:252:3)
        at async _runTestsForDescribeBlock (C:\projects\specverse\node_modules\jest-circus\build\run.js:126:9)
        at async _runTestsForDescribeBlock (C:\projects\specverse\node_modules\jest-circus\build\run.js:121:9)
        at async run (C:\projects\specverse\node_modules\jest-circus\build\run.js:71:3)
        at async runAndTransformResultsToJestFormat (C:\projects\specverse\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at async jestAdapter (C:\projects\specverse\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at async runTestInternal (C:\projects\specverse\node_modules\jest-runner\build\runTest.js:367:16)
        at async runTest (C:\projects\specverse\node_modules\jest-runner\build\runTest.js:444:34) {
      errno: -4068,
      code: 'EISDIR',
      syscall: 'read'
    }

      254 |     }
      255 |   } catch (error) {
    > 256 |     console.error('Error inserting logo:', error)
          |             ^
      257 |   }
      258 |
      259 |   sheet1.mergeCells('C1:H1')

      at generateDatasheetExcel (src/utils/generateDatasheetExcel.ts:256:13)
      at Object.<anonymous> (tests/utils/generateDatasheetExcel.test.ts:80:52)


ReferenceError: You are trying to `import` a file after the Jest environment has been torn down. From 
tests/api/valuesets.filled.test.ts.

      at BufferListStream.Readable 
(node_modules/mssql/node_modules/readable-stream/lib/internal/streams/readable.js:209:36)
      at BufferListStream.Duplex (node_modules/mssql/node_modules/readable-stream/lib/internal/streams/duplex.js:50:12)
      at new BufferListStream (node_modules/mssql/node_modules/bl/bl.js:33:16)
      at new IncomingMessageStream (node_modules/mssql/node_modules/tedious/src/incoming-message-stream.ts:24:15)
      at new MessageIO (node_modules/mssql/node_modules/tedious/src/message-io.ts:40:34)
      at Connection.socketHandlingForSendPreLogin (node_modules/mssql/node_modules/tedious/src/connection.ts:2025:22)
      at node_modules/mssql/node_modules/tedious/src/connection.ts:2115:12
FAIL backend tests/utils/generateDatasheetExcel.test.ts
  generateDatasheetExcel USC conversion
    ├ù converts SI values to USC units when uom=USC (195 ms)

  ΓùÅ generateDatasheetExcel USC conversion ΓÇ║ converts SI values to USC units when uom=USC

    Unhandled error. (ConnectionError: Failed to connect to JEFF-DESKTOP:1433 - Right-hand side of 'instanceof' is not 
callable

      at connectListener (node_modules/mssql/lib/tedious/connection-pool.js:85:17)
      at Connection.onConnect (node_modules/mssql/node_modules/tedious/src/connection.ts:1784:9)
      at Connection.emit (node_modules/mssql/node_modules/tedious/src/connection.ts:1927:18)
      at Connection.socketError (node_modules/mssql/node_modules/tedious/src/connection.ts:2334:12)
      at node_modules/mssql/node_modules/tedious/src/connection.ts:2123:37
      at processTicksAndRejections (node:internal/process/task_queues:77:11) {
        code: 'ESOCKET',
        originalError: ConnectionError: Failed to connect to JEFF-DESKTOP:1433 - Right-hand side of 'instanceof' is 
not callable
      at Connection.socketError (node_modules/mssql/node_modules/tedious/src/connection.ts:2334:28)
      at node_modules/mssql/node_modules/tedious/src/connection.ts:2123:37
      at processTicksAndRejections (node:internal/process/task_queues:77:11) {
          code: 'ESOCKET',
          [cause]: TypeError: Right-hand side of 'instanceof' is not callable
      at BufferListStream.Readable 
(node_modules/mssql/node_modules/readable-stream/lib/internal/streams/readable.js:209:25)
      at BufferListStream.Duplex (node_modules/mssql/node_modules/readable-stream/lib/internal/streams/duplex.js:50:12)
      at new BufferListStream (node_modules/mssql/node_modules/bl/bl.js:33:16)
      at new IncomingMessageStream (node_modules/mssql/node_modules/tedious/src/incoming-message-stream.ts:24:15)
      at new MessageIO (node_modules/mssql/node_modules/tedious/src/message-io.ts:40:34)
      at Connection.socketHandlingForSendPreLogin (node_modules/mssql/node_modules/tedious/src/connection.ts:2025:22)
      at node_modules/mssql/node_modules/tedious/src/connection.ts:2115:12
        }
      })
      at node_modules/mssql/lib/base/connection-pool.js:367:12

  ΓùÅ generateDatasheetExcel USC conversion ΓÇ║ converts SI values to USC units when uom=USC

    Unhandled error. (ConnectionError: Failed to connect to JEFF-DESKTOP:1433 - Right-hand side of 'instanceof' is not 
callable

      at connectListener (node_modules/mssql/lib/tedious/connection-pool.js:85:17)
      at Connection.onConnect (node_modules/mssql/node_modules/tedious/src/connection.ts:1784:9)
      at Connection.emit (node_modules/mssql/node_modules/tedious/src/connection.ts:1927:18)
      at Connection.socketError (node_modules/mssql/node_modules/tedious/src/connection.ts:2334:12)
      at node_modules/mssql/node_modules/tedious/src/connection.ts:2123:37
      at processTicksAndRejections (node:internal/process/task_queues:77:11) {
        code: 'ESOCKET',
        originalError: ConnectionError: Failed to connect to JEFF-DESKTOP:1433 - Right-hand side of 'instanceof' is 
not callable
      at Connection.socketError (node_modules/mssql/node_modules/tedious/src/connection.ts:2334:28)
      at node_modules/mssql/node_modules/tedious/src/connection.ts:2123:37
      at processTicksAndRejections (node:internal/process/task_queues:77:11) {
          code: 'ESOCKET',
          [cause]: TypeError: Right-hand side of 'instanceof' is not callable
      at BufferListStream.Readable 
(node_modules/mssql/node_modules/readable-stream/lib/internal/streams/readable.js:209:25)
      at BufferListStream.Duplex (node_modules/mssql/node_modules/readable-stream/lib/internal/streams/duplex.js:50:12)
      at new BufferListStream (node_modules/mssql/node_modules/bl/bl.js:33:16)
      at new IncomingMessageStream (node_modules/mssql/node_modules/tedious/src/incoming-message-stream.ts:24:15)
      at new MessageIO (node_modules/mssql/node_modules/tedious/src/message-io.ts:40:34)
      at Connection.socketHandlingForSendPreLogin (node_modules/mssql/node_modules/tedious/src/connection.ts:2025:22)
      at node_modules/mssql/node_modules/tedious/src/connection.ts:2115:12
        }
      })
      at node_modules/mssql/lib/base/connection-pool.js:367:12

  console.warn
    Γ¢ö No token received

      48 |
      49 |   if (!token) {
    > 50 |     console.warn('Γ¢ö No token received')
         |             ^
      51 |     next(new AppError('Unauthorized - No token', 401))
      52 |     return
      53 |   }

      at verifyToken (src/backend/middleware/authMiddleware.ts:50:13)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/body-parser/lib/read.js:171:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    AppError: Unauthorized - No token
        at verifyToken (C:\projects\specverse\src\backend\middleware\authMiddleware.ts:51:10)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:57:14)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at C:\projects\specverse\node_modules\body-parser\lib\read.js:171:5
        at AsyncResource.runInAsyncScope (node:async_hooks:206:9)
        at invokeCallback (C:\projects\specverse\node_modules\raw-body\index.js:238:16)
        at done (C:\projects\specverse\node_modules\raw-body\index.js:227:7)
        at IncomingMessage.onEnd (C:\projects\specverse\node_modules\raw-body\index.js:287:7)
        at IncomingMessage.emit (node:events:524:28)
        at IncomingMessage.emit (node:domain:489:12)
        at endReadableNT (node:internal/streams/readable:1698:12)
        at processTicksAndRejections (node:internal/process/task_queues:82:21) {
      statusCode: 401,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at next (node_modules/router/lib/route.js:155:13)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at next (node_modules/router/lib/route.js:155:13)
      at verifyToken (src/backend/middleware/authMiddleware.ts:51:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/body-parser/lib/read.js:171:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    AppError: Permission denied
        at C:\projects\specverse\src\backend\middleware\authMiddleware.ts:92:14
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 403,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at next (node_modules/router/lib/route.js:155:13)
      at src/backend/middleware/authMiddleware.ts:92:9

  console.warn
    Γ¢ö No token received

      48 |
      49 |   if (!token) {
    > 50 |     console.warn('Γ¢ö No token received')
         |             ^
      51 |     next(new AppError('Unauthorized - No token', 401))
      52 |     return
      53 |   }

      at verifyToken (src/backend/middleware/authMiddleware.ts:50:13)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at param (node_modules/router/index.js:600:14)
      at param (node_modules/router/index.js:610:14)
      at processParams (node_modules/router/index.js:664:3)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:53:5)
      at jsonParser (node_modules/body-parser/lib/types/json.js:88:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

  console.error
    AppError: Unauthorized - No token
        at verifyToken (C:\projects\specverse\src\backend\middleware\authMiddleware.ts:51:10)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at param (C:\projects\specverse\node_modules\router\index.js:600:14)
        at param (C:\projects\specverse\node_modules\router\index.js:610:14)
        at processParams (C:\projects\specverse\node_modules\router\index.js:664:3)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:57:14)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at read (C:\projects\specverse\node_modules\body-parser\lib\read.js:53:5)
        at jsonParser (C:\projects\specverse\node_modules\body-parser\lib\types\json.js:88:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at Function.handle (C:\projects\specverse\node_modules\express\lib\application.js:177:15)
        at Server.app (C:\projects\specverse\node_modules\express\lib\express.js:38:9)
        at Server.emit (node:events:524:28)
        at Server.emit (node:domain:489:12)
        at parserOnIncoming (node:_http_server:1141:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:118:17) {
      statusCode: 401,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at next (node_modules/router/lib/route.js:155:13)
      at verifyToken (src/backend/middleware/authMiddleware.ts:51:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at param (node_modules/router/index.js:600:14)
      at param (node_modules/router/index.js:610:14)
      at processParams (node_modules/router/index.js:664:3)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:53:5)
      at jsonParser (node_modules/body-parser/lib/types/json.js:88:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

  console.error
    AppError: Permission denied
        at getExportJobStatusHandler (C:\projects\specverse\src\backend\controllers\exportJobsController.ts:109:12)
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 403,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at getExportJobStatusHandler (src/backend/controllers/exportJobsController.ts:109:7)

  console.error
    AppError: Export job not found
        at getExportJobStatusHandler (C:\projects\specverse\src\backend\controllers\exportJobsController.ts:103:12)
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 404,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at getExportJobStatusHandler (src/backend/controllers/exportJobsController.ts:103:7)

  console.error
    AppError: Unauthorized
        at downloadExportJobHandler (C:\projects\specverse\src\backend\controllers\exportJobsController.ts:155:14)
        at C:\projects\specverse\src\backend\utils\asyncHandler.ts:5:25
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at optionalVerifyToken (C:\projects\specverse\src\backend\middleware\authMiddleware.ts:18:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at param (C:\projects\specverse\node_modules\router\index.js:600:14)
        at param (C:\projects\specverse\node_modules\router\index.js:610:14)
        at processParams (C:\projects\specverse\node_modules\router\index.js:664:3)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:57:14)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at read (C:\projects\specverse\node_modules\body-parser\lib\read.js:53:5)
        at jsonParser (C:\projects\specverse\node_modules\body-parser\lib\types\json.js:88:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at Function.handle (C:\projects\specverse\node_modules\express\lib\application.js:177:15)
        at Server.app (C:\projects\specverse\node_modules\express\lib\express.js:38:9)
        at Server.emit (node:events:524:28)
        at Server.emit (node:domain:489:12)
        at parserOnIncoming (node:_http_server:1141:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:118:17) {
      statusCode: 401,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at downloadExportJobHandler (src/backend/controllers/exportJobsController.ts:155:9)
      at src/backend/utils/asyncHandler.ts:5:25
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at optionalVerifyToken (src/backend/middleware/authMiddleware.ts:18:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at param (node_modules/router/index.js:600:14)
      at param (node_modules/router/index.js:610:14)
      at processParams (node_modules/router/index.js:664:3)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:53:5)
      at jsonParser (node_modules/body-parser/lib/types/json.js:88:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

  console.error
    AppError: Invalid or expired download link
        at downloadExportJobHandler (C:\projects\specverse\src\backend\controllers\exportJobsController.ts:141:14)
        at C:\projects\specverse\src\backend\utils\asyncHandler.ts:5:25
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at optionalVerifyToken (C:\projects\specverse\src\backend\middleware\authMiddleware.ts:18:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at param (C:\projects\specverse\node_modules\router\index.js:600:14)
        at param (C:\projects\specverse\node_modules\router\index.js:610:14)
        at processParams (C:\projects\specverse\node_modules\router\index.js:664:3)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:57:14)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at read (C:\projects\specverse\node_modules\body-parser\lib\read.js:53:5)
        at jsonParser (C:\projects\specverse\node_modules\body-parser\lib\types\json.js:88:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at Function.handle (C:\projects\specverse\node_modules\express\lib\application.js:177:15)
        at Server.app (C:\projects\specverse\node_modules\express\lib\express.js:38:9)
        at Server.emit (node:events:524:28)
        at Server.emit (node:domain:489:12)
        at parserOnIncoming (node:_http_server:1141:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:118:17) {
      statusCode: 403,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at downloadExportJobHandler (src/backend/controllers/exportJobsController.ts:141:9)
      at src/backend/utils/asyncHandler.ts:5:25
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at optionalVerifyToken (src/backend/middleware/authMiddleware.ts:18:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at param (node_modules/router/index.js:600:14)
      at param (node_modules/router/index.js:610:14)
      at processParams (node_modules/router/index.js:664:3)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:53:5)
      at jsonParser (node_modules/body-parser/lib/types/json.js:88:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

  console.error
    AppError: Permission denied
        at downloadExportJobHandler (C:\projects\specverse\src\backend\controllers\exportJobsController.ts:150:14)
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 403,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at downloadExportJobHandler (src/backend/controllers/exportJobsController.ts:150:9)

  console.error
    AppError: Permission denied
        at cancelExportJobHandler (C:\projects\specverse\src\backend\controllers\exportJobsController.ts:255:12)
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 403,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

  console.warn
    Γ¢ö No token received

      48 |
      49 |   if (!token) {
    > 50 |     console.warn('Γ¢ö No token received')
         |             ^
      51 |     next(new AppError('Unauthorized - No token', 401))
      52 |     return
      53 |   }

      at verifyToken (src/backend/middleware/authMiddleware.ts:50:13)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:62:5)
      at jsonParser (node_modules/body-parser/lib/types/json.js:88:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

  console.error
    AppError: Unauthorized - No token
        at verifyToken (C:\projects\specverse\src\backend\middleware\authMiddleware.ts:51:10)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:57:14)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at read (C:\projects\specverse\node_modules\body-parser\lib\read.js:62:5)
        at jsonParser (C:\projects\specverse\node_modules\body-parser\lib\types\json.js:88:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at Function.handle (C:\projects\specverse\node_modules\express\lib\application.js:177:15)
        at Server.app (C:\projects\specverse\node_modules\express\lib\express.js:38:9)
        at Server.emit (node:events:524:28)
        at Server.emit (node:domain:489:12)
        at parserOnIncoming (node:_http_server:1141:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:118:17) {
      statusCode: 401,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at next (node_modules/router/lib/route.js:155:13)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at next (node_modules/router/lib/route.js:155:13)
      at verifyToken (src/backend/middleware/authMiddleware.ts:51:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:62:5)
      at jsonParser (node_modules/body-parser/lib/types/json.js:88:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

  console.error
    AppError: Admin access required
        at requireAdmin (C:\projects\specverse\src\backend\middleware\requireAdmin.ts:21:10)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at verifyToken (C:\projects\specverse\src\backend\middleware\authMiddleware.ts:74:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:71:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at read (C:\projects\specverse\node_modules\body-parser\lib\read.js:62:5)
        at jsonParser (C:\projects\specverse\node_modules\body-parser\lib\types\json.js:88:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at Function.handle (C:\projects\specverse\node_modules\express\lib\application.js:177:15)
        at Server.app (C:\projects\specverse\node_modules\express\lib\express.js:38:9)
        at Server.emit (node:events:524:28)
        at Server.emit (node:domain:489:12)
        at parserOnIncoming (node:_http_server:1141:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:118:17) {
      statusCode: 403,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at next (node_modules/router/lib/route.js:155:13)
      at requireAdmin (src/backend/middleware/requireAdmin.ts:21:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at verifyToken (src/backend/middleware/authMiddleware.ts:74:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:71:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:62:5)
      at jsonParser (node_modules/body-parser/lib/types/json.js:88:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

PASS backend tests/api/exportJobs.test.ts
  Export Jobs API
    POST /api/backend/exports/jobs
      ΓêÜ returns 401 when unauthenticated (32 ms)
      ΓêÜ returns 403 when authenticated without INVENTORY_VIEW (9 ms)
      ΓêÜ creates job and returns 201 with jobId when pre-check passes (9 ms)
      ΓêÜ returns 413 when pre-check exceeds 10k rows (5 ms)
    GET /api/backend/exports/jobs/:jobId
      ΓêÜ returns 401 when unauthenticated (17 ms)
      ΓêÜ returns 200 with status for owner (6 ms)
      ΓêÜ returns 403 for non-owner (non-admin) (8 ms)
      ΓêÜ returns 200 for admin when viewing another user job (6 ms)
      ΓêÜ returns 404 when job does not exist (7 ms)
    GET /api/backend/exports/jobs/:jobId/download
      ΓêÜ returns 401 when no token and no session (9 ms)
      ΓêÜ returns 403 when token jobId does not match request jobId (16 ms)
      ΓêÜ returns 403 when token is valid but user is not job owner (7 ms)
      ΓêÜ returns 410 when export expired or file missing (5 ms)
      ΓêÜ returns 200 and file when completed and not expired (session) (9 ms)
    GET /api/backend/exports/jobs/:jobId/download-url
      ΓêÜ returns downloadUrl and fileName when completed and not expired (5 ms)
    POST /api/backend/exports/jobs/:jobId/cancel
      ΓêÜ returns 200 and updated status when job is queued (5 ms)
      ΓêÜ returns 403 for non-owner (6 ms)
    POST /api/backend/exports/jobs/cleanup
      ΓêÜ returns 401 when unauthenticated (17 ms)
      ΓêÜ returns 403 when not admin (11 ms)
      ΓêÜ returns 200 with deletedFiles when admin (6 ms)

  console.warn
    Γ¢ö No token received

      48 |
      49 |   if (!token) {
    > 50 |     console.warn('Γ¢ö No token received')
         |             ^
      51 |     next(new AppError('Unauthorized - No token', 401))
      52 |     return
      53 |   }

      at verifyToken (src/backend/middleware/authMiddleware.ts:50:13)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:53:5)
      at jsonParser (node_modules/body-parser/lib/types/json.js:88:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

  console.error
    AppError: Unauthorized - No token
        at verifyToken (C:\projects\specverse\src\backend\middleware\authMiddleware.ts:51:10)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:57:14)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at read (C:\projects\specverse\node_modules\body-parser\lib\read.js:53:5)
        at jsonParser (C:\projects\specverse\node_modules\body-parser\lib\types\json.js:88:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at Function.handle (C:\projects\specverse\node_modules\express\lib\application.js:177:15)
        at Server.app (C:\projects\specverse\node_modules\express\lib\express.js:38:9)
        at Server.emit (node:events:524:28)
        at Server.emit (node:domain:489:12)
        at parserOnIncoming (node:_http_server:1141:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:118:17) {
      statusCode: 401,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

  console.error
    AppError: Admin access required
        at requireAdmin (C:\projects\specverse\src\backend\middleware\requireAdmin.ts:21:10)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at verifyToken (C:\projects\specverse\src\backend\middleware\authMiddleware.ts:74:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:71:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at read (C:\projects\specverse\node_modules\body-parser\lib\read.js:53:5)
        at jsonParser (C:\projects\specverse\node_modules\body-parser\lib\types\json.js:88:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at Function.handle (C:\projects\specverse\node_modules\express\lib\application.js:177:15)
        at Server.app (C:\projects\specverse\node_modules\express\lib\express.js:38:9)
        at Server.emit (node:events:524:28)
        at Server.emit (node:domain:489:12)
        at parserOnIncoming (node:_http_server:1141:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:118:17) {
      statusCode: 403,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

  console.error
    listAuditLogsHandler error: AppError: Invalid audit log row: missing LogID/AuditLogID
        at mapRowToDTO (C:\projects\specverse\src\backend\services\auditLogsService.ts:76:11)
        at C:\projects\specverse\src\backend\services\auditLogsService.ts:130:42
        at Array.map (<anonymous>)
        at listAuditLogs (C:\projects\specverse\src\backend\services\auditLogsService.ts:130:29)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at async listAuditLogsHandler (C:\projects\specverse\src\backend\controllers\auditLogsController.ts:118:20) {
      statusCode: 500,
      isOperational: true
    }

      119 |     res.json(result)
      120 |   } catch (err) {
    > 121 |     console.error('listAuditLogsHandler error:', err)
          |             ^
      122 |     if (err instanceof AppError) {
      123 |       next(err)
      124 |       return

      at listAuditLogsHandler (src/backend/controllers/auditLogsController.ts:121:13)

  console.error
    AppError: Invalid audit log row: missing LogID/AuditLogID
        at mapRowToDTO (C:\projects\specverse\src\backend\services\auditLogsService.ts:76:11)
        at C:\projects\specverse\src\backend\services\auditLogsService.ts:130:42
        at Array.map (<anonymous>)
        at listAuditLogs (C:\projects\specverse\src\backend\services\auditLogsService.ts:130:29)
        at processTicksAndRejections (node:internal/process/task_queues:95:5)
        at async listAuditLogsHandler (C:\projects\specverse\src\backend\controllers\auditLogsController.ts:118:20) {
      statusCode: 500,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

  console.error
    AppError: Invalid query parameters
        at listAuditLogsHandler (C:\projects\specverse\src\backend\controllers\auditLogsController.ts:92:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at requireAdmin (C:\projects\specverse\src\backend\middleware\requireAdmin.ts:25:3)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at verifyToken (C:\projects\specverse\src\backend\middleware\authMiddleware.ts:74:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:71:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at read (C:\projects\specverse\node_modules\body-parser\lib\read.js:53:5)
        at jsonParser (C:\projects\specverse\node_modules\body-parser\lib\types\json.js:88:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at Function.handle (C:\projects\specverse\node_modules\express\lib\application.js:177:15)
        at Server.app (C:\projects\specverse\node_modules\express\lib\express.js:38:9)
        at Server.emit (node:events:524:28)
        at Server.emit (node:domain:489:12)
        at parserOnIncoming (node:_http_server:1141:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:118:17) {
      statusCode: 400,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

  console.error
    AppError: Invalid query parameters
        at listAuditLogsHandler (C:\projects\specverse\src\backend\controllers\auditLogsController.ts:92:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at requireAdmin (C:\projects\specverse\src\backend\middleware\requireAdmin.ts:25:3)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at verifyToken (C:\projects\specverse\src\backend\middleware\authMiddleware.ts:74:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:71:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at read (C:\projects\specverse\node_modules\body-parser\lib\read.js:53:5)
        at jsonParser (C:\projects\specverse\node_modules\body-parser\lib\types\json.js:88:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at Function.handle (C:\projects\specverse\node_modules\express\lib\application.js:177:15)
        at Server.app (C:\projects\specverse\node_modules\express\lib\express.js:38:9)
        at Server.emit (node:events:524:28)
        at Server.emit (node:domain:489:12)
        at parserOnIncoming (node:_http_server:1141:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:118:17) {
      statusCode: 400,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

PASS backend tests/api/audit-logs.test.ts
  Audit Logs API
    Authentication and Authorization
      ΓêÜ returns 401 when unauthenticated (130 ms)
      ΓêÜ returns 403 when authenticated but not admin (11 ms)
      ΓêÜ returns 200 when authenticated as admin (7 ms)
    Response Shape
      ΓêÜ returns { page, pageSize, total, rows } with defaults (8 ms)
      ΓêÜ returns rows[] with numeric auditLogId and unique keys (6 ms)
      ΓêÜ maps LogID to auditLogId when DB returns LogID (9 ms)
      ΓêÜ returns 500 when row has neither LogID nor AuditLogID (9 ms)
    Pagination
      ΓêÜ pageSize=1 returns 1 row (4 ms)
      ΓêÜ page 2 returns different row when pageSize=1 (7 ms)
    Filtering
      ΓêÜ filter by entityType reduces results (4 ms)
      ΓêÜ filter by entityType + entityId reduces results (6 ms)
    Validation
      ΓêÜ returns 400 for invalid page (negative) (7 ms)
      ΓêÜ returns 400 for invalid pageSize (too large) (7 ms)

  console.error
    Warning: <SvgMock /> is using incorrect casing. Use PascalCase for React components, or lowercase for HTML elements.
        at SvgMock
        at span
        at button
        at li
        at ul
        at div
        at div
        at nav
        at div
        at aside
        at AppSidebar (C:\projects\specverse\src\layout\AppSidebar.tsx:124:59)

      48 |     })
      49 |
    > 50 |     render(<AppSidebar />)
         |           ^
      51 |
      52 |     expect(screen.getByText('Administration')).toBeInTheDocument()
      53 |     const auditLogsLinks = screen.getAllByRole('link', { name: /audit logs/i })

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at createElement (node_modules/react-dom/cjs/react-dom.development.js:9761:9)
      at createInstance (node_modules/react-dom/cjs/react-dom.development.js:10941:20)
      at completeWork (node_modules/react-dom/cjs/react-dom.development.js:22187:28)
      at completeUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26593:16)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26568:5)
      at workLoopSync (node_modules/react-dom/cjs/react-dom.development.js:26466:5)
      at renderRootSync (node_modules/react-dom/cjs/react-dom.development.js:26434:7)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25738:74)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:46:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:189:26)
      at render (node_modules/@testing-library/react/dist/pure.js:291:10)
      at Object.<anonymous> (tests/ui/AppSidebar.test.tsx:50:11)

  console.error
    Warning: The tag <SvgMock> is unrecognized in this browser. If you meant to render a React component, start its name with an uppercase letter.
        at SvgMock
        at span
        at button
        at li
        at ul
        at div
        at div
        at nav
        at div
        at aside
        at AppSidebar (C:\projects\specverse\src\layout\AppSidebar.tsx:124:59)

      48 |     })
      49 |
    > 50 |     render(<AppSidebar />)
         |           ^
      51 |
      52 |     expect(screen.getByText('Administration')).toBeInTheDocument()
      53 |     const auditLogsLinks = screen.getAllByRole('link', { name: /audit logs/i })

      at printWarning (node_modules/react-dom/cjs/react-dom.development.js:86:30)
      at error (node_modules/react-dom/cjs/react-dom.development.js:60:7)
      at createElement (node_modules/react-dom/cjs/react-dom.development.js:9816:9)
      at createInstance (node_modules/react-dom/cjs/react-dom.development.js:10941:20)
      at completeWork (node_modules/react-dom/cjs/react-dom.development.js:22187:28)
      at completeUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26593:16)
      at performUnitOfWork (node_modules/react-dom/cjs/react-dom.development.js:26568:5)
      at workLoopSync (node_modules/react-dom/cjs/react-dom.development.js:26466:5)
      at renderRootSync (node_modules/react-dom/cjs/react-dom.development.js:26434:7)
      at performConcurrentWorkOnRoot (node_modules/react-dom/cjs/react-dom.development.js:25738:74)
      at flushActQueue (node_modules/react/cjs/react.development.js:2667:24)
      at act (node_modules/react/cjs/react.development.js:2582:11)
      at node_modules/@testing-library/react/dist/act-compat.js:46:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:189:26)
      at render (node_modules/@testing-library/react/dist/pure.js:291:10)
      at Object.<anonymous> (tests/ui/AppSidebar.test.tsx:50:11)

PASS frontend tests/ui/AppSidebar.test.tsx
  AppSidebar role gating
    ΓêÜ hides Administration and Audit Logs for non-admin (53 ms)
    ΓêÜ shows Administration and Audit Logs for admin (160 ms)
    ΓêÜ shows skeleton nav while loading (7 ms)

PASS backend tests/api/filledAttachments.reference.test.ts
  Filled sheet attachments reference template attachments
    ΓêÜ GET /api/backend/filledsheets/:id returns attachments including referenced template attachment (323 ms)

PASS backend tests/api/audit.dedupe.test.ts
  Audit dedupe
    ΓêÜ Update Filled Sheet produces exactly one audit insert (344 ms)

PASS backend tests/api/valuesets.slice3.test.ts
  Phase 2 Slice #3 value-set API
    POST valuesets Offered (createOfferedValueSet + prefill)
      ΓêÜ creates offered set with partyId and returns 201 with valueSetId (119 ms)
      ΓêÜ AsBuilt uses createAsBuiltValueSet and returns 201 with valueSetId (4 ms)
      ΓêÜ Requirement still uses createValueSet (no partyId) (4 ms)
    PATCH valuesets/:valueSetId/variances
      ΓêÜ upsert sets ReviewedBy/ReviewedAt and returns 204 (5 ms)
      ΓêÜ status=null deletes row and returns 204 (3 ms)
      ΓêÜ returns 409 when ValueSet status is not Draft (3 ms)
    POST valuesets/:valueSetId/status
      ΓêÜ allowed transition succeeds and returns 200 (5 ms)
      ΓêÜ invalid transition returns 409 (3 ms)
    GET compare
      ΓêÜ returns expected shape and includes variance overrides (3 ms)
      ΓêÜ passes offeredPartyId query when provided (3 ms)

PASS frontend tests/ui/datasheets/FilledNewNotePage.test.tsx
  Filled sheet notes new page
    ΓêÜ sends { text } in the request body to /api/backend/filledsheets/:id/notes (59 ms)

PASS frontend tests/ui/datasheets/FilledSheetClonerForm.test.tsx
  FilledSheetClonerForm
    ΓêÜ requires equipment tag number and shows error when missing (102 ms)
    ΓêÜ POSTs to /api/backend/filledsheets on success (53 ms)

PASS backend tests/utils/exportAuditSection.test.ts
  Export Audit Trail sections
    ΓêÜ generates a PDF buffer with audit section without error (7 ms)
    ΓêÜ generates an Excel workbook that includes an Audit Log worksheet (57 ms)

  console.warn
    Γ¢ö No token received

      48 |
      49 |   if (!token) {
    > 50 |     console.warn('Γ¢ö No token received')
         |             ^
      51 |     next(new AppError('Unauthorized - No token', 401))
      52 |     return
      53 |   }

      at verifyToken (src/backend/middleware/authMiddleware.ts:50:13)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at param (node_modules/router/index.js:600:14)
      at param (node_modules/router/index.js:610:14)
      at processParams (node_modules/router/index.js:664:3)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:53:5)
      at jsonParser (node_modules/body-parser/lib/types/json.js:88:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

  console.error
    AppError: Unauthorized - No token
        at verifyToken (C:\projects\specverse\src\backend\middleware\authMiddleware.ts:51:10)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at param (C:\projects\specverse\node_modules\router\index.js:600:14)
        at param (C:\projects\specverse\node_modules\router\index.js:610:14)
        at processParams (C:\projects\specverse\node_modules\router\index.js:664:3)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:57:14)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at read (C:\projects\specverse\node_modules\body-parser\lib\read.js:53:5)
        at jsonParser (C:\projects\specverse\node_modules\body-parser\lib\types\json.js:88:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at Function.handle (C:\projects\specverse\node_modules\express\lib\application.js:177:15)
        at Server.app (C:\projects\specverse\node_modules\express\lib\express.js:38:9)
        at Server.emit (node:events:524:28)
        at Server.emit (node:domain:489:12)
        at parserOnIncoming (node:_http_server:1141:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:118:17) {
      statusCode: 401,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at next (node_modules/router/lib/route.js:155:13)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at next (node_modules/router/lib/route.js:155:13)
      at verifyToken (src/backend/middleware/authMiddleware.ts:51:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at param (node_modules/router/index.js:600:14)
      at param (node_modules/router/index.js:610:14)
      at processParams (node_modules/router/index.js:664:3)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:53:5)
      at jsonParser (node_modules/body-parser/lib/types/json.js:88:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

PASS backend tests/api/inventory.maintenance.auth.test.ts
  Inventory maintenance auth
    ΓêÜ GET /api/backend/inventory/:id/maintenance returns 401 when unauthenticated (149 ms)
    ΓêÜ GET /api/backend/inventory/:id/maintenance returns 200 when authenticated with cookie (7 ms)
    ΓêÜ GET /api/backend/inventory/1/maintenance returns array with canonical shape when authenticated (6 ms)

  console.warn
    Γ¢ö No token received

      48 |
      49 |   if (!token) {
    > 50 |     console.warn('Γ¢ö No token received')
         |             ^
      51 |     next(new AppError('Unauthorized - No token', 401))
      52 |     return
      53 |   }

      at verifyToken (src/backend/middleware/authMiddleware.ts:50:13)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at param (node_modules/router/index.js:600:14)
      at param (node_modules/router/index.js:610:14)
      at processParams (node_modules/router/index.js:664:3)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/body-parser/lib/read.js:171:5
      at invokeCallback (node_modules/raw-body/index.js:238:16)
      at done (node_modules/raw-body/index.js:227:7)
      at IncomingMessage.onEnd (node_modules/raw-body/index.js:287:7)

  console.error
    AppError: Unauthorized - No token
        at verifyToken (C:\projects\specverse\src\backend\middleware\authMiddleware.ts:51:10)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at param (C:\projects\specverse\node_modules\router\index.js:600:14)
        at param (C:\projects\specverse\node_modules\router\index.js:610:14)
        at processParams (C:\projects\specverse\node_modules\router\index.js:664:3)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:57:14)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at C:\projects\specverse\node_modules\body-parser\lib\read.js:171:5
        at AsyncResource.runInAsyncScope (node:async_hooks:206:9)
        at invokeCallback (C:\projects\specverse\node_modules\raw-body\index.js:238:16)
        at done (C:\projects\specverse\node_modules\raw-body\index.js:227:7)
        at IncomingMessage.onEnd (C:\projects\specverse\node_modules\raw-body\index.js:287:7)
        at IncomingMessage.emit (node:events:524:28)
        at IncomingMessage.emit (node:domain:489:12)
        at endReadableNT (node:internal/streams/readable:1698:12)
        at processTicksAndRejections (node:internal/process/task_queues:82:21) {
      statusCode: 401,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

  console.error
    AppError: Admin access required
        at requireAdmin (C:\projects\specverse\src\backend\middleware\requireAdmin.ts:21:10)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at verifyToken (C:\projects\specverse\src\backend\middleware\authMiddleware.ts:74:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at param (C:\projects\specverse\node_modules\router\index.js:600:14)
        at param (C:\projects\specverse\node_modules\router\index.js:610:14)
        at processParams (C:\projects\specverse\node_modules\router\index.js:664:3)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:71:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at C:\projects\specverse\node_modules\body-parser\lib\read.js:171:5
        at AsyncResource.runInAsyncScope (node:async_hooks:206:9)
        at invokeCallback (C:\projects\specverse\node_modules\raw-body\index.js:238:16)
        at done (C:\projects\specverse\node_modules\raw-body\index.js:227:7)
        at IncomingMessage.onEnd (C:\projects\specverse\node_modules\raw-body\index.js:287:7)
        at IncomingMessage.emit (node:events:524:28)
        at IncomingMessage.emit (node:domain:489:12)
        at endReadableNT (node:internal/streams/readable:1698:12)
        at processTicksAndRejections (node:internal/process/task_queues:82:21) {
      statusCode: 403,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

  console.error
    AppError: Invalid userId
        at resetPassword (C:\projects\specverse\src\backend\controllers\usersController.ts:250:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at requireAdmin (C:\projects\specverse\src\backend\middleware\requireAdmin.ts:25:3)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at verifyToken (C:\projects\specverse\src\backend\middleware\authMiddleware.ts:74:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at param (C:\projects\specverse\node_modules\router\index.js:600:14)
        at param (C:\projects\specverse\node_modules\router\index.js:610:14)
        at processParams (C:\projects\specverse\node_modules\router\index.js:664:3)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:71:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at C:\projects\specverse\node_modules\body-parser\lib\read.js:171:5
        at AsyncResource.runInAsyncScope (node:async_hooks:206:9)
        at invokeCallback (C:\projects\specverse\node_modules\raw-body\index.js:238:16)
        at done (C:\projects\specverse\node_modules\raw-body\index.js:227:7)
        at IncomingMessage.onEnd (C:\projects\specverse\node_modules\raw-body\index.js:287:7)
        at IncomingMessage.emit (node:events:524:28)
        at IncomingMessage.emit (node:domain:489:12)
        at endReadableNT (node:internal/streams/readable:1698:12)
        at processTicksAndRejections (node:internal/process/task_queues:82:21) {
      statusCode: 400,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

  console.error
    AppError: User not found
        at resetPassword (C:\projects\specverse\src\backend\controllers\usersController.ts:278:12)
        at processTicksAndRejections (node:internal/process/task_queues:95:5) {
      statusCode: 404,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at Immediate.next (node_modules/router/index.js:291:5)
      at Immediate._onImmediate (node_modules/router/index.js:688:15)

PASS backend tests/api/admin.passwordReset.test.ts
  Admin Password Reset
    Authentication and Authorization
      ΓêÜ returns 401 when unauthenticated (29 ms)
      ΓêÜ returns 403 when authenticated but not admin (8 ms)
    Success Cases
      ΓêÜ returns 200 with tempPassword when newPassword not provided (6 ms)
      ΓêÜ returns 200 without tempPassword when newPassword is provided (6 ms)
    Validation
      ΓêÜ returns 400 for invalid userId (8 ms)
      ΓêÜ returns 400 for invalid body shape (7 ms)
    User Not Found
      ΓêÜ returns 404 when user does not exist (10 ms)

  console.warn
    Γ¢ö No token received

      48 |
      49 |   if (!token) {
    > 50 |     console.warn('Γ¢ö No token received')
         |             ^
      51 |     next(new AppError('Unauthorized - No token', 401))
      52 |     return
      53 |   }

      at verifyToken (src/backend/middleware/authMiddleware.ts:50:13)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:53:5)
      at jsonParser (node_modules/body-parser/lib/types/json.js:88:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

PASS backend tests/middleware/authMiddleware.test.ts
  verifyToken middleware
    ΓêÜ should block access without token (14 ms)
    ΓêÜ should allow access with valid token (6 ms)

  console.warn
    Γ¢ö No token received

      48 |
      49 |   if (!token) {
    > 50 |     console.warn('Γ¢ö No token received')
         |             ^
      51 |     next(new AppError('Unauthorized - No token', 401))
      52 |     return
      53 |   }

      at verifyToken (src/backend/middleware/authMiddleware.ts:50:13)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:53:5)
      at jsonParser (node_modules/body-parser/lib/types/json.js:88:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

  console.error
    AppError: Unauthorized - No token
        at verifyToken (C:\projects\specverse\src\backend\middleware\authMiddleware.ts:51:10)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:57:14)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at read (C:\projects\specverse\node_modules\body-parser\lib\read.js:53:5)
        at jsonParser (C:\projects\specverse\node_modules\body-parser\lib\types\json.js:88:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at Function.handle (C:\projects\specverse\node_modules\express\lib\application.js:177:15)
        at Server.app (C:\projects\specverse\node_modules\express\lib\express.js:38:9)
        at Server.emit (node:events:524:28)
        at Server.emit (node:domain:489:12)
        at parserOnIncoming (node:_http_server:1141:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:118:17) {
      statusCode: 401,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at next (node_modules/router/lib/route.js:155:13)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at next (node_modules/router/lib/route.js:155:13)
      at verifyToken (src/backend/middleware/authMiddleware.ts:51:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:53:5)
      at jsonParser (node_modules/body-parser/lib/types/json.js:88:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

PASS backend tests/api/reports.inventoryContribution.test.ts
  GET /api/backend/reports/inventory-contribution
    ΓêÜ returns 401 when unauthenticated (114 ms)
    ΓêÜ returns 200 and array with categoryName and items for each element (7 ms)
    ΓêÜ returns empty items array for category with no items (5 ms)

  console.warn
    Γ¢ö No token received

      48 |
      49 |   if (!token) {
    > 50 |     console.warn('Γ¢ö No token received')
         |             ^
      51 |     next(new AppError('Unauthorized - No token', 401))
      52 |     return
      53 |   }

      at verifyToken (src/backend/middleware/authMiddleware.ts:50:13)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at param (node_modules/router/index.js:600:14)
      at param (node_modules/router/index.js:610:14)
      at processParams (node_modules/router/index.js:664:3)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:53:5)
      at jsonParser (node_modules/body-parser/lib/types/json.js:88:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

  console.error
    AppError: Unauthorized - No token
        at verifyToken (C:\projects\specverse\src\backend\middleware\authMiddleware.ts:51:10)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at param (C:\projects\specverse\node_modules\router\index.js:600:14)
        at param (C:\projects\specverse\node_modules\router\index.js:610:14)
        at processParams (C:\projects\specverse\node_modules\router\index.js:664:3)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:57:14)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at read (C:\projects\specverse\node_modules\body-parser\lib\read.js:53:5)
        at jsonParser (C:\projects\specverse\node_modules\body-parser\lib\types\json.js:88:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at Function.handle (C:\projects\specverse\node_modules\express\lib\application.js:177:15)
        at Server.app (C:\projects\specverse\node_modules\express\lib\express.js:38:9)
        at Server.emit (node:events:524:28)
        at Server.emit (node:domain:489:12)
        at parserOnIncoming (node:_http_server:1141:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:118:17) {
      statusCode: 401,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at next (node_modules/router/lib/route.js:155:13)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at next (node_modules/router/lib/route.js:155:13)
      at verifyToken (src/backend/middleware/authMiddleware.ts:51:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at param (node_modules/router/index.js:600:14)
      at param (node_modules/router/index.js:610:14)
      at processParams (node_modules/router/index.js:664:3)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:53:5)
      at jsonParser (node_modules/body-parser/lib/types/json.js:88:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

PASS backend tests/api/inventory.audit.auth.test.ts
  Inventory audit auth
    ΓêÜ GET /api/backend/inventory/:id/audit returns 401 when unauthenticated (130 ms)
    ΓêÜ GET /api/backend/inventory/:id/audit returns 200 when authenticated with cookie (7 ms)

  console.error
    AppError: Unauthorized - No token
        at verifyToken (C:\projects\specverse\tests\api\inventory.all.maintenance.test.ts:39:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:57:14)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at read (C:\projects\specverse\node_modules\body-parser\lib\read.js:53:5)
        at jsonParser (C:\projects\specverse\node_modules\body-parser\lib\types\json.js:88:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at Function.handle (C:\projects\specverse\node_modules\express\lib\application.js:177:15)
        at Server.app (C:\projects\specverse\node_modules\express\lib\express.js:38:9)
        at Server.emit (node:events:524:28)
        at Server.emit (node:domain:489:12)
        at parserOnIncoming (node:_http_server:1141:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:118:17) {
      statusCode: 401,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at next (node_modules/router/lib/route.js:155:13)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at next (node_modules/router/lib/route.js:155:13)
      at verifyToken (tests/api/inventory.all.maintenance.test.ts:39:7)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:53:5)
      at jsonParser (node_modules/body-parser/lib/types/json.js:88:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

PASS backend tests/api/inventory.all.maintenance.test.ts
  GET /api/backend/inventory/all/maintenance
    ΓêÜ returns 401 when unauthenticated (25 ms)
    ΓêÜ returns 200 and array with maintenanceId, inventoryId, itemName when authenticated (6 ms)

  console.warn
    Γ¢ö No token received

      48 |
      49 |   if (!token) {
    > 50 |     console.warn('Γ¢ö No token received')
         |             ^
      51 |     next(new AppError('Unauthorized - No token', 401))
      52 |     return
      53 |   }

      at verifyToken (src/backend/middleware/authMiddleware.ts:50:13)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:53:5)
      at jsonParser (node_modules/body-parser/lib/types/json.js:88:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

  console.error
    AppError: Unauthorized - No token
        at verifyToken (C:\projects\specverse\src\backend\middleware\authMiddleware.ts:51:10)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at next (C:\projects\specverse\node_modules\router\lib\route.js:157:13)
        at Route.dispatch (C:\projects\specverse\node_modules\router\lib\route.js:117:3)
        at handle (C:\projects\specverse\node_modules\router\index.js:435:11)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at C:\projects\specverse\node_modules\router\index.js:295:15
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at router (C:\projects\specverse\node_modules\router\index.js:60:12)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at cookieParser (C:\projects\specverse\node_modules\cookie-parser\index.js:57:14)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at read (C:\projects\specverse\node_modules\body-parser\lib\read.js:53:5)
        at jsonParser (C:\projects\specverse\node_modules\body-parser\lib\types\json.js:88:5)
        at Layer.handleRequest (C:\projects\specverse\node_modules\router\lib\layer.js:152:17)
        at trimPrefix (C:\projects\specverse\node_modules\router\index.js:342:13)
        at C:\projects\specverse\node_modules\router\index.js:297:9
        at processParams (C:\projects\specverse\node_modules\router\index.js:582:12)
        at next (C:\projects\specverse\node_modules\router\index.js:291:5)
        at Function.handle (C:\projects\specverse\node_modules\router\index.js:186:3)
        at Function.handle (C:\projects\specverse\node_modules\express\lib\application.js:177:15)
        at Server.app (C:\projects\specverse\node_modules\express\lib\express.js:38:9)
        at Server.emit (node:events:524:28)
        at Server.emit (node:domain:489:12)
        at parserOnIncoming (node:_http_server:1141:12)
        at HTTPParser.parserOnHeadersComplete (node:_http_common:118:17) {
      statusCode: 401,
      isOperational: true
    }

      28 |
      29 |   if (process.env.NODE_ENV !== 'production') {
    > 30 |     console.error(err)
         |             ^
      31 |   }
      32 |
      33 |   // Backwards compatible shape: many clients expect `error`.

      at errorHandler (src/backend/middleware/errorHandler.ts:30:13)
      at Layer.handleError (node_modules/router/lib/layer.js:116:17)
      at trimPrefix (node_modules/router/index.js:340:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at node_modules/router/index.js:688:15
      at next (node_modules/router/index.js:276:14)
      at next (node_modules/router/lib/route.js:132:14)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at next (node_modules/router/lib/route.js:155:13)
      at Layer.handleError (node_modules/router/lib/layer.js:111:12)
      at next (node_modules/router/lib/route.js:155:13)
      at verifyToken (src/backend/middleware/authMiddleware.ts:51:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at read (node_modules/body-parser/lib/read.js:53:5)
      at jsonParser (node_modules/body-parser/lib/types/json.js:88:5)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

PASS backend tests/api/inventory.all.audit.test.ts
  GET /api/backend/inventory/all/audit
    ΓêÜ returns 401 when unauthenticated (28 ms)
    ΓêÜ returns 200 and array with unique integer auditLogId per row when authenticated (7 ms)

PASS backend tests/services/templateService.test.ts
  templateService.getAllNoteTypes
    ΓêÜ returns an array of note types with expected shape (1 ms)
  templateService.doesTemplateEquipmentTagExist
    ΓêÜ returns false for a clearly non-existent tag / project combination
  templateService.doesTemplateEquipmentTagExist ΓÇô true case
    ΓêÜ returns true when a matching (EquipmentTagNum, ProjectID) exists (1 ms)

PASS backend tests/services/filledSheetUpdateUpsert.test.ts
  updateFilledSheet UPSERT behavior
    ΓêÜ does not execute DELETE on InformationValues (no wholesale delete) (7 ms)
    ΓêÜ uses UPDATE or INSERT for InformationValues (UPSERT)
    ΓêÜ legacy row path: UPDATE sets ValueSetID (migrate-in-place)

  console.warn
    Γ¢ö No token received

      48 |
      49 |   if (!token) {
    > 50 |     console.warn('Γ¢ö No token received')
         |             ^
      51 |     next(new AppError('Unauthorized - No token', 401))
      52 |     return
      53 |   }

      at verifyToken (src/backend/middleware/authMiddleware.ts:50:13)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at param (node_modules/router/index.js:600:14)
      at param (node_modules/router/index.js:610:14)
      at processParams (node_modules/router/index.js:664:3)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

  console.warn
    Γ¢ö No token received

      48 |
      49 |   if (!token) {
    > 50 |     console.warn('Γ¢ö No token received')
         |             ^
      51 |     next(new AppError('Unauthorized - No token', 401))
      52 |     return
      53 |   }

      at verifyToken (src/backend/middleware/authMiddleware.ts:50:13)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at param (node_modules/router/index.js:600:14)
      at param (node_modules/router/index.js:610:14)
      at processParams (node_modules/router/index.js:664:3)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

  console.warn
    Γ¢ö No token received

      48 |
      49 |   if (!token) {
    > 50 |     console.warn('Γ¢ö No token received')
         |             ^
      51 |     next(new AppError('Unauthorized - No token', 401))
      52 |     return
      53 |   }

      at verifyToken (src/backend/middleware/authMiddleware.ts:50:13)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at param (node_modules/router/index.js:600:14)
      at param (node_modules/router/index.js:610:14)
      at processParams (node_modules/router/index.js:664:3)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

PASS backend tests/api/sheetLogs.test.ts
  Sheet logs endpoints
    ΓêÜ GET /api/backend/sheets/:sheetId/audit-logs returns 401 when unauthenticated (12 ms)
    ΓêÜ GET /api/backend/sheets/:sheetId/audit-logs returns 200 and shape when authenticated (7 ms)
    ΓêÜ GET /api/backend/sheets/:sheetId/change-logs returns 401 when unauthenticated (13 ms)
    ΓêÜ GET /api/backend/sheets/:sheetId/change-logs returns 200 and shape when authenticated (6 ms)
    ΓêÜ GET /api/backend/sheets/:sheetId/logs returns 401 when unauthenticated (6 ms)
    ΓêÜ GET /api/backend/sheets/:sheetId/logs returns 200 and shape when authenticated (5 ms)

PASS backend tests/api/exportHeaders.test.ts
  Export headers
    ΓêÜ sets Content-Disposition filename for filled sheet Excel export (35 ms)
    ΓêÜ sets Content-Disposition filename for template PDF export (14 ms)

PASS frontend tests/ui/datasheets/TemplateNewNotePage.test.tsx
  Template notes new page
    ΓêÜ sends { text } in the request body to /api/backend/templates/:id/notes (71 ms)

  console.warn
    Γ¢ö No token received

      48 |
      49 |   if (!token) {
    > 50 |     console.warn('Γ¢ö No token received')
         |             ^
      51 |     next(new AppError('Unauthorized - No token', 401))
      52 |     return
      53 |   }

      at verifyToken (src/backend/middleware/authMiddleware.ts:50:13)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

PASS backend tests/api/stats.auth.test.ts
  Stats auth
    ΓêÜ returns 401 when unauthenticated (19 ms)
    ΓêÜ returns 200 when authenticated (6 ms)

PASS backend tests/api/filledAttachments.list.canonical.test.ts
  Filled sheet attachments list - canonical
    ΓêÜ returns canonical attachments including isFromTemplate and linkedFromSheetId by default (18 ms)

PASS backend tests/api/filledAttachments.delete.canonicalFirst.test.ts
  Filled sheet attachments delete - canonical first with legacy fallback
    ΓêÜ uses canonical delete when link exists and does not call legacy delete (21 ms)
    ΓêÜ falls back to legacy delete when no canonical link is removed (6 ms)

  console.warn
    Γ¢ö No token received

      48 |
      49 |   if (!token) {
    > 50 |     console.warn('Γ¢ö No token received')
         |             ^
      51 |     next(new AppError('Unauthorized - No token', 401))
      52 |     return
      53 |   }

      at verifyToken (src/backend/middleware/authMiddleware.ts:50:13)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at next (node_modules/router/lib/route.js:157:13)
      at Route.dispatch (node_modules/router/lib/route.js:117:3)
      at handle (node_modules/router/index.js:435:11)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at node_modules/router/index.js:295:15
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at router (node_modules/router/index.js:60:12)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at cookieParser (node_modules/cookie-parser/index.js:57:14)
      at Layer.handleRequest (node_modules/router/lib/layer.js:152:17)
      at trimPrefix (node_modules/router/index.js:342:13)
      at node_modules/router/index.js:297:9
      at processParams (node_modules/router/index.js:582:12)
      at next (node_modules/router/index.js:291:5)
      at Function.handle (node_modules/router/index.js:186:3)
      at Function.handle (node_modules/express/lib/application.js:177:15)
      at Server.app (node_modules/express/lib/express.js:38:9)

PASS backend tests/api/reports.auth.test.ts
  Reports auth
    ΓêÜ returns 401 when unauthenticated (13 ms)
    ΓêÜ returns 200 when authenticated (5 ms)

PASS backend tests/services/valueSetQueries.test.ts
  valueSetQueries
    getContextIdByCode
      ΓêÜ returns ContextID for Requirement (1 ms)
      ΓêÜ returns null when code not found
    getValueSetId
      ΓêÜ returns ValueSetID when set exists (1 ms)
      ΓêÜ returns null when set does not exist
    ensureRequirementValueSet
      ΓêÜ creates one set when none exists and reuses on second call
      ΓêÜ returns existing ValueSetID without inserting when set already exists
    createOfferedValueSet
      ΓêÜ returns existing Offered ValueSet id when set already exists; runs set-based prefill once (no per-row 
INSERT) (1 ms)
      ΓêÜ does not throw when called twice; second call returns same id
    getRequirementValueRows
      ΓêÜ returns effective view: one row per InfoTemplateID, prefer ValueSet then legacy (1 ms)
      ΓêÜ includes legacy requirement values when ValueSet rows are missing (1 ms)
    ensureRequirementValueSetInTransaction
      ΓêÜ creates ValueSet when none exists and returns ValueSetID (1 ms)
      ΓêÜ returns existing ValueSetID when set exists (1 ms)

PASS frontend tests/ui/SecurePage.test.tsx
  SecurePage gating
    ΓêÜ redirects to /unauthorized when user lacks required permission (4 ms)
    ΓêÜ does not redirect when user has required permission (2 ms)
    ΓêÜ redirects to /unauthorized when requiredRole does not match (1 ms)
    ΓêÜ does not redirect when requiredRole matches (case-insensitive) (2 ms)

PASS backend tests/services/valueSetSlice3.test.ts
  valueSet Slice #3 service
    createOfferedValueSet
      ΓêÜ creates offered set and prefills from requirement (delegates to query) (1 ms)
      ΓêÜ re-running returns same id (idempotent, no duplicate values) (1 ms)
    patchVariance
      ΓêÜ upserts row with status and sets ReviewedBy/ReviewedAt via query (1 ms)
      ΓêÜ status=null deletes variance row
      ΓêÜ rejects when ValueSet status is not Draft (1 ms)
      ΓêÜ rejects when context is Requirement
    transitionValueSetStatus
      ΓêÜ Requirement/Offered Draft -> Locked succeeds
      ΓêÜ AsBuilt Draft -> Verified succeeds
      ΓêÜ invalid transition rejected (409) (1 ms)
      ΓêÜ current status not Draft rejected (409) (1 ms)
    getCompareData
      ΓêÜ returns expected shape and includes variance overrides (2 ms)

PASS backend tests/utils/datasheetCompleteness.test.ts
  computeCompleteness
    ΓêÜ returns 0/0 when no subsheets (2 ms)
    ΓêÜ counts one required empty as incomplete (1 ms)
    ΓêÜ counts one required filled as complete (1 ms)
    ΓêÜ ignores optional fields for counts
    ΓêÜ treats numeric 0 as complete
    ΓêÜ treats required select with empty string as incomplete (1 ms)
    ΓêÜ mixed required/optional and empty/non-empty (1 ms)
    ΓêÜ uses fieldValues override when provided (edit mode)
    ΓêÜ falls back to field.value when fieldValues has no key for field.id (1 ms)
    ΓêÜ keys bySubsheet by subsheet id (or originalId, or index) (1 ms)
  getSubsheetKey
    ΓêÜ uses id when present
    ΓêÜ uses originalId when id missing
    ΓêÜ falls back to index when neither id nor originalId (1 ms)

PASS backend tests/domain/datasheets/revisionDiff.test.ts
  diffUnifiedSheets
    ΓêÜ returns zero changed/added/removed when sheets are identical (2 ms)
    ΓêÜ detects a single changed field value (1 ms)
    ΓêÜ marks field present only in B as added (1 ms)
    ΓêÜ marks field present only in A as removed (10 ms)
    ΓêÜ is order-independent for subsheets and fields (1 ms)

  console.error
    Permission middleware error: Error: DB error test
        at Object.<anonymous> (C:\projects\specverse\tests\middleware\datasheetPermissions.test.ts:115:7)
        at Promise.then.completed (C:\projects\specverse\node_modules\jest-circus\build\utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (C:\projects\specverse\node_modules\jest-circus\build\utils.js:231:10)
        at _callCircusTest (C:\projects\specverse\node_modules\jest-circus\build\run.js:316:40)
        at async _runTest (C:\projects\specverse\node_modules\jest-circus\build\run.js:252:3)
        at async _runTestsForDescribeBlock (C:\projects\specverse\node_modules\jest-circus\build\run.js:126:9)
        at async _runTestsForDescribeBlock (C:\projects\specverse\node_modules\jest-circus\build\run.js:121:9)
        at async run (C:\projects\specverse\node_modules\jest-circus\build\run.js:71:3)
        at async runAndTransformResultsToJestFormat (C:\projects\specverse\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapterInit.js:122:21)
        at async jestAdapter (C:\projects\specverse\node_modules\jest-circus\build\legacy-code-todo-rewrite\jestAdapter.js:79:19)
        at async runTestInternal (C:\projects\specverse\node_modules\jest-runner\build\runTest.js:367:16)
        at async runTest (C:\projects\specverse\node_modules\jest-runner\build\runTest.js:444:34)

       96 |       next()
       97 |     } catch (error) {
    >  98 |       console.error('Permission middleware error:', error)
          |               ^
       99 |       next(new AppError('Server error', 500))
      100 |     }
      101 |   }

      at src/backend/middleware/authMiddleware.ts:98:15
      at async Object.<anonymous> (tests/middleware/datasheetPermissions.test.ts:118:5)

PASS backend tests/middleware/datasheetPermissions.test.ts
  requirePermission middleware
    ΓêÜ calls next when user has the required permission (1 ms)
    ΓêÜ returns 403 when user is present but does not have the permission
    ΓêÜ returns 403 when req.user is missing
    ΓêÜ returns 500 when checkUserPermission throws (3 ms)

PASS backend tests/schemas/filledVerifySchema.test.ts
  verifyFilledSheetBodySchema
    ΓêÜ accepts action=verify without rejectionComment (1 ms)
    ΓêÜ accepts action=reject when rejectionComment is non-empty (1 ms)
    ΓêÜ rejects action=reject when rejectionComment is missing or empty (3 ms)
    ΓêÜ rejects unsupported action values (1 ms)

PASS backend tests/schemas/templateVerifySchema.test.ts
  verifyTemplateBodySchema
    ΓêÜ accepts action=verify without rejectionComment (1 ms)
    ΓêÜ accepts action=reject when rejectionComment is non-empty
    ΓêÜ rejects action=reject when rejectionComment is missing or empty (3 ms)
    ΓêÜ rejects unsupported action values (1 ms)

PASS backend tests/utils/chartDataUtils.test.ts
  normalizeCategoryContribution
    ΓêÜ returns empty array for null input (1 ms)
    ΓêÜ returns empty array for undefined input (1 ms)
    ΓêÜ returns empty array for non-array input
    ΓêÜ treats items: null as empty items array and does not throw
    ΓêÜ treats missing items as empty items array and does not throw
    ΓêÜ treats items as object (non-array) as empty items array (1 ms)
    ΓêÜ produces valid chart rows for well-formed input (1 ms)
  hasNoUsableData
    ΓêÜ returns true for empty array
    ΓêÜ returns true when every category has items.length === 0
    ΓêÜ returns false when at least one category has items (1 ms)

PASS backend tests/schemas/unifiedSheetSchema.test.ts
  unifiedSheetSchema
    ΓêÜ rejects payload with no subsheets array (1 ms)
    ΓêÜ rejects payload with an empty subsheets array
    ΓêÜ rejects payload when subsheets is not an array

PASS backend tests/api/reports.vendorQuotes.param.test.ts
  getVendorQuotesFromDB
    ΓêÜ uses the passed EstimationID parameter in the SQL query (1 ms)

Summary of all failing tests
FAIL tests/utils/generateDatasheetExcel.test.ts
  ΓùÅ generateDatasheetExcel USC conversion ΓÇ║ converts SI values to USC units when uom=USC

    Unhandled error. (ConnectionError: Failed to connect to JEFF-DESKTOP:1433 - Right-hand side of 'instanceof' is not 
callable

      at connectListener (node_modules/mssql/lib/tedious/connection-pool.js:85:17)
      at Connection.onConnect (node_modules/mssql/node_modules/tedious/src/connection.ts:1784:9)
      at Connection.emit (node_modules/mssql/node_modules/tedious/src/connection.ts:1927:18)
      at Connection.socketError (node_modules/mssql/node_modules/tedious/src/connection.ts:2334:12)
      at node_modules/mssql/node_modules/tedious/src/connection.ts:2123:37
      at processTicksAndRejections (node:internal/process/task_queues:77:11) {
        code: 'ESOCKET',
        originalError: ConnectionError: Failed to connect to JEFF-DESKTOP:1433 - Right-hand side of 'instanceof' is 
not callable
      at Connection.socketError (node_modules/mssql/node_modules/tedious/src/connection.ts:2334:28)
      at node_modules/mssql/node_modules/tedious/src/connection.ts:2123:37
      at processTicksAndRejections (node:internal/process/task_queues:77:11) {
          code: 'ESOCKET',
          [cause]: TypeError: Right-hand side of 'instanceof' is not callable
      at BufferListStream.Readable 
(node_modules/mssql/node_modules/readable-stream/lib/internal/streams/readable.js:209:25)
      at BufferListStream.Duplex (node_modules/mssql/node_modules/readable-stream/lib/internal/streams/duplex.js:50:12)
      at new BufferListStream (node_modules/mssql/node_modules/bl/bl.js:33:16)
      at new IncomingMessageStream (node_modules/mssql/node_modules/tedious/src/incoming-message-stream.ts:24:15)
      at new MessageIO (node_modules/mssql/node_modules/tedious/src/message-io.ts:40:34)
      at Connection.socketHandlingForSendPreLogin (node_modules/mssql/node_modules/tedious/src/connection.ts:2025:22)
      at node_modules/mssql/node_modules/tedious/src/connection.ts:2115:12
        }
      })
      at node_modules/mssql/lib/base/connection-pool.js:367:12

  ΓùÅ generateDatasheetExcel USC conversion ΓÇ║ converts SI values to USC units when uom=USC

    Unhandled error. (ConnectionError: Failed to connect to JEFF-DESKTOP:1433 - Right-hand side of 'instanceof' is not 
callable

      at connectListener (node_modules/mssql/lib/tedious/connection-pool.js:85:17)
      at Connection.onConnect (node_modules/mssql/node_modules/tedious/src/connection.ts:1784:9)
      at Connection.emit (node_modules/mssql/node_modules/tedious/src/connection.ts:1927:18)
      at Connection.socketError (node_modules/mssql/node_modules/tedious/src/connection.ts:2334:12)
      at node_modules/mssql/node_modules/tedious/src/connection.ts:2123:37
      at processTicksAndRejections (node:internal/process/task_queues:77:11) {
        code: 'ESOCKET',
        originalError: ConnectionError: Failed to connect to JEFF-DESKTOP:1433 - Right-hand side of 'instanceof' is 
not callable
      at Connection.socketError (node_modules/mssql/node_modules/tedious/src/connection.ts:2334:28)
      at node_modules/mssql/node_modules/tedious/src/connection.ts:2123:37
      at processTicksAndRejections (node:internal/process/task_queues:77:11) {
          code: 'ESOCKET',
          [cause]: TypeError: Right-hand side of 'instanceof' is not callable
      at BufferListStream.Readable 
(node_modules/mssql/node_modules/readable-stream/lib/internal/streams/readable.js:209:25)
      at BufferListStream.Duplex (node_modules/mssql/node_modules/readable-stream/lib/internal/streams/duplex.js:50:12)
      at new BufferListStream (node_modules/mssql/node_modules/bl/bl.js:33:16)
      at new IncomingMessageStream (node_modules/mssql/node_modules/tedious/src/incoming-message-stream.ts:24:15)
      at new MessageIO (node_modules/mssql/node_modules/tedious/src/message-io.ts:40:34)
      at Connection.socketHandlingForSendPreLogin (node_modules/mssql/node_modules/tedious/src/connection.ts:2025:22)
      at node_modules/mssql/node_modules/tedious/src/connection.ts:2115:12
        }
      })
      at node_modules/mssql/lib/base/connection-pool.js:367:12


Test Suites: 1 failed, 47 passed, 48 total
Tests:       1 failed, 241 passed, 242 total
Snapshots:   0 total
Time:        25.022 s, estimated 30 s
Ran all test suites in 2 projects.
Jest did not exit one second after the test run has completed.

'This usually means that there are asynchronous operations that weren't stopped in your tests. Consider running Jest 
with `--detectOpenHandles` to troubleshoot this issue.
